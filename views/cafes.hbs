<h6>Welcome:{{user}}</h6>


<a class="details" href="/cafeForm">Add a cafe</a>
<br>
<br>
<<<<<<< HEAD
<a href="/auth/logout">Logout</a>
=======
<a class="details" href="/auth/logout">Logout</a>
>>>>>>> auth

<div id='map' style='width: 600px; height: 400px;'></div>
<pre id='coordinates' class='coordinates'></pre>

<script>
    mapboxgl.accessToken = 'pk.eyJ1IjoicGF2aXoiLCJhIjoiY2syenk4cThtMDJmZzNucmN0cXM2OXVqZCJ9.kWENQ9HBsyj_LbjsAZqB4Q';
    var coordinates = document.getElementById('coordinates');
    var map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/streets-v11',
        center: [13.40, 52.52],
        zoom: 10
    });

    map.addControl(new MapboxGeocoder({
        accessToken: mapboxgl.accessToken,
        mapboxgl: mapboxgl

    }));



    var marker = new mapboxgl.Marker({
        draggable: true
    })
        .setLngLat([13.40, 52.52])
        .addTo(map);

    function onDragEnd() {
        var lngLat = marker.getLngLat();
        coordinates.style.display = 'block';
        coordinates.innerHTML = 'Longitude: ' + lngLat.lng + '<br />Latitude: ' + lngLat.lat;

        map.flyTo({ center: lngLat });

        axios.post("/api/points", {
            coordinates: [lngLat.lng, lngLat.lat]
        }).then(response => {
            console.log(response)
        }).catch(err => {
            console.log(err);
        })
    }
    marker.on('dragend', onDragEnd);

    const getMarkers = () => {
        console.log('getMarkers')
        axios.get('/api/points').then(response => {
            response.data.forEach(point => {
                console.log(point);
                new mapboxgl.Marker().setLngLat(point.coordinates).addTo(map);
            })
        }).catch(err => {
            console.log(err);
        })
    }
    getMarkers();
</script>

{{!-- <script>
    mapboxgl.accessToken = 'pk.eyJ1IjoicGF2aXoiLCJhIjoiY2syenk4cThtMDJmZzNucmN0cXM2OXVqZCJ9.kWENQ9HBsyj_LbjsAZqB4Q';
    var map = new mapboxgl.Map({
        container: 'map',
        style: "mapbox://styles/mapbox/streets-v9",
        center: [13.40, 52.52],
        zoom: 10
    });
    // map.addControl(new MapboxGeocoder({
    // accessToken: mapboxgl.accessToken,
    // mapboxgl: mapboxgl
    // }));
    // let marker = new mapboxgl.Marker({
    //   draggable: true,
    // color: "red",
    // }).setLngLat([13, 52]).addTo(map); // set coordinates for marker, place on map

    var marker = new mapboxgl.Marker()
        .setLngLat([30.5, 50.5])
        .addTo(map);

    marker.on("dragend", () => {
        const lngLat = marker.getLngLat();
        console.log(lngLat);
        map.flyTo({ center: lngLat });

        axios.post("/api/points", {
            coordinates: [lngLat.lng, lngLat.lat]
        }).then(response => {
            console.log(response)
        }).catch(err => {
            console.log(err);
        })
    });

    const getMarkers = () => {
        console.log('getMarkers')
        axios.get('/api/points').then(response => {
            response.data.forEach(point => {
                console.log(point)
                new mapboxgl.Marker().setLngLat(point.coordinates).addTo(map);
            })
        }).catch(err => {
            console.log(err)
        })
    }
    getMarkers();
</script> --}}

<<<<<<< HEAD

<a href="/cafeForm">Add a cafe</a>
<a href="/auth/logout">Logout</a>
=======
{{!-- <a href="/cafeForm">Add a cafe</a>
<a href="/auth/logout">Logout</a> --}}
>>>>>>> auth

<h1>List</h1>
{{#each cafe}}

<ul>
    <li>{{name}}</li>
    <li>{{address}}</li>
    <li>{{description}}</li>
</ul>

<hr>


{{/each}}