<h1>Welcome:{{user.username}}</h1>

{{#if cafe}}
<h2>Your profile</h2>
{{/if}}

<h1>Here is our list of cafes</h1>
<a href="/cafeForm">Add a cafe</a>
<br>
<br>
<a href="/auth/logout">Logout</a>
<div id='map' style='width: 600px; height: 400px;'></div>
<script>
    mapboxgl.accessToken = 'pk.eyJ1IjoicGF2aXoiLCJhIjoiY2syenk4cThtMDJmZzNucmN0cXM2OXVqZCJ9.kWENQ9HBsyj_LbjsAZqB4Q';
    var map = new mapboxgl.Map({
        container: 'map',
        style: "mapbox://styles/mapbox/streets-v11",
        center: [13.40, 52.52],
        zoom: 10
    });
    map.addControl(new MapboxGeocoder({
        accessToken: mapboxgl.accessToken,
        mapboxgl: mapboxgl
    }));
    let marker = new mapboxgl.Marker({
        draggable: true,
        color: "red"
    }).setLngLat([13, 52]).addTo(map); // set coordinates for marker, place on map

    marker.on("dragend", () => {
        const lngLat = marker.getLngLat();
        console.log(lngLat);
        map.flyTo({ center: lngLat });

        axios.post("/api/points", {
            coordinates: [lngLat.lng, lngLat.lat]
        }).then(response => {
            console.log(response)
        }).catch(err => {
            console.log(err);
        })
    });
    
    const getMarkers = () => {
        axios.get('/api/points').then(response => {
            response.data.forEach(point => {
                console.log(point)
                new mapboxgl.Marker().setLngLat(point.coordinates).addTo(map);
            })
        }).catch(err => {
            console.log(err)
        })
    }
    getMarkers();
</script>
{{!-- 
<h2>Map</h2>
<div id='map' style='width: 400px; height: 300px;'></div>
<script>
    let coordinates = [{{ cafe.coordinates }}];
    const draggable = {{ draggable }}
    if (!coordinates.length) {
        coordinates = [0, 0]
    }
    mapboxgl.accessToken = 'pk.eyJ1IjoibWppaCIsImEiOiJjanVwb3p2M2kxczk2M3ptcDRlc2cwYTZpIn0.B8dDJ9aejgRYjjc1hh2w1g';
    var map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mjih/ck2zl2b8205wq1co4hdik26gu',
        center: coordinates,
        zoom: 2
    });
    var marker = new mapboxgl.Marker({
        draggable: {{ draggable }}
  })
    .setLngLat(coordinates)
        .addTo(map);
    function onDragEnd() {
        var lngLat = marker.getLngLat();
        axios.post('/cafes/{{cafe._id}}/update', {
            coordinates: [lngLat.lng, lngLat.lat]
        });
        map.flyTo({ center: lngLat })
    }
    marker.on('dragend', onDragEnd);
</script> --}}

<a href="/cafeForm">Add a cafe</a>
<a href="/auth/logout">Logout</a>

<h1>List</h1>
{{#each cafe}}

<ul>
    <li>{{name}}</li>
    <li>{{address}}</li>
    <li>{{description}}</li>
</ul>

<hr>
{{/each}}